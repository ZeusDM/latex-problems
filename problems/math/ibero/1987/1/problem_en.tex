Find the function $f(x)$ such that\[f(x)^2f\left(\frac{1-x}{x+1}\right) =64x \]

for $x\not=0,x\not=1,x\not=-1$.