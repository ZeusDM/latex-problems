For any positive integer $m$, denote by $P(m)$ the product of positive divisors of $m$ (e.g $P(6)=36$). For every positive integer $n$ define the sequence
$$a_1(n)=n,\qquad a_{k+1}(n)=P(a_k(n))\quad (k=1,2,\dots,2016)$$Determine whether for every set $S\subset\{1,2,\dots,2017\}$, there exists a positive integer $n$ such that the following condition is satisfied:
\textit{For every  with , the number  is a perfect square if and only if }.